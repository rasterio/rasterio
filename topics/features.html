

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Vector Features &mdash; rasterio 1.0a9 documentation</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  

  

  
    <link rel="top" title="rasterio 1.0a9 documentation" href="../index.html"/>
        <link rel="next" title="Filling nodata areas" href="fillnodata.html"/>
        <link rel="prev" title="Error Handling" href="errors.html"/> 

  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../index.html" class="icon icon-home"> rasterio
          

          
          </a>

          
            
            
              <div class="version">
                1.0a9
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <ul>
<li class="toctree-l1"><a class="reference internal" href="../intro.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../quickstart.html">Quickstart</a></li>
<li class="toctree-l1"><a class="reference internal" href="../switch.html">Switching from GDAL&#8217;s Python bindings</a></li>
</ul>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="color.html">Color</a></li>
<li class="toctree-l1"><a class="reference internal" href="concurrency.html">Concurrent processing</a></li>
<li class="toctree-l1"><a class="reference internal" href="errors.html">Error Handling</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Vector Features</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#extracting-shapes-of-raster-features">Extracting shapes of raster features</a></li>
<li class="toctree-l2"><a class="reference internal" href="#burning-shapes-into-a-raster">Burning shapes into a raster</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="fillnodata.html">Filling nodata areas</a></li>
<li class="toctree-l1"><a class="reference internal" href="georeferencing.html">Georeferencing</a></li>
<li class="toctree-l1"><a class="reference internal" href="image_options.html">Options</a></li>
<li class="toctree-l1"><a class="reference internal" href="image_processing.html">Interoperability</a></li>
<li class="toctree-l1"><a class="reference internal" href="masking-by-shapefile.html">Masking a raster using a shapefile</a></li>
<li class="toctree-l1"><a class="reference internal" href="masks.html">Nodata Masks</a></li>
<li class="toctree-l1"><a class="reference internal" href="memory-files.html">In-Memory Files</a></li>
<li class="toctree-l1"><a class="reference internal" href="migrating-to-v1.html">Migrating to Rasterio 1.0</a></li>
<li class="toctree-l1"><a class="reference internal" href="overviews.html">Overviews</a></li>
<li class="toctree-l1"><a class="reference internal" href="plotting.html">Plotting</a></li>
<li class="toctree-l1"><a class="reference internal" href="reproject.html">Reprojection</a></li>
<li class="toctree-l1"><a class="reference internal" href="resampling.html">Resampling</a></li>
<li class="toctree-l1"><a class="reference internal" href="tags.html">Tagging datasets and bands</a></li>
<li class="toctree-l1"><a class="reference internal" href="vsi.html">Virtual Files</a></li>
<li class="toctree-l1"><a class="reference internal" href="windowed-rw.html">Windowed reading and writing</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../api/index.html">rasterio package</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../cli.html">Command Line Users Guide</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../contributing.html">Contributing</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../index.html">rasterio</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          

 



<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html">Docs</a> &raquo;</li>
      
    <li>Vector Features</li>
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../_sources/topics/features.txt" rel="nofollow"> View page source</a>
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="vector-features">
<h1>Vector Features<a class="headerlink" href="#vector-features" title="Permalink to this headline">¶</a></h1>
<p>Rasterio&#8217;s <code class="docutils literal"><span class="pre">features</span></code> module provides functions to extract shapes of raster
features and to create new features by &#8220;burning&#8221; shapes into rasters:
<code class="docutils literal"><span class="pre">shapes()</span></code> and <code class="docutils literal"><span class="pre">rasterize()</span></code>. These functions expose GDAL functions in
a general way, using iterators over GeoJSON-like Python objects instead of
GIS layers.</p>
<div class="section" id="extracting-shapes-of-raster-features">
<h2>Extracting shapes of raster features<a class="headerlink" href="#extracting-shapes-of-raster-features" title="Permalink to this headline">¶</a></h2>
<p>Consider the Python logo.</p>
<img alt="https://farm8.staticflickr.com/7018/13547682814_f2e459f7a5_o_d.png" src="https://farm8.staticflickr.com/7018/13547682814_f2e459f7a5_o_d.png" />
<p>The shapes of the foreground features can be extracted like this:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pprint</span>
<span class="kn">import</span> <span class="nn">rasterio</span>
<span class="kn">from</span> <span class="nn">rasterio</span> <span class="kn">import</span> <span class="n">features</span>

<span class="k">with</span> <span class="n">rasterio</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s1">&#39;13547682814_f2e459f7a5_o_d.png&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">src</span><span class="p">:</span>
    <span class="n">blue</span> <span class="o">=</span> <span class="n">src</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>

<span class="n">mask</span> <span class="o">=</span> <span class="n">blue</span> <span class="o">!=</span> <span class="mi">255</span>
<span class="n">shapes</span> <span class="o">=</span> <span class="n">features</span><span class="o">.</span><span class="n">shapes</span><span class="p">(</span><span class="n">blue</span><span class="p">,</span> <span class="n">mask</span><span class="o">=</span><span class="n">mask</span><span class="p">)</span>
<span class="n">pprint</span><span class="o">.</span><span class="n">pprint</span><span class="p">(</span><span class="nb">next</span><span class="p">(</span><span class="n">shapes</span><span class="p">))</span>

<span class="c1"># Output</span>
<span class="c1"># pprint.pprint(next(shapes))</span>
<span class="c1"># ({&#39;coordinates&#39;: [[(71.0, 6.0),</span>
<span class="c1">#                    (71.0, 7.0),</span>
<span class="c1">#                    (72.0, 7.0),</span>
<span class="c1">#                    (72.0, 6.0),</span>
<span class="c1">#                    (71.0, 6.0)]],</span>
<span class="c1">#   &#39;type&#39;: &#39;Polygon&#39;},</span>
<span class="c1"># 253)</span>
</pre></div>
</div>
<p>The shapes iterator yields <code class="docutils literal"><span class="pre">geometry,</span> <span class="pre">value</span></code> pairs. The second item is the
value of the raster feature corresponding to the shape and the first is its
geometry.  The coordinates of the geometries in this case are in pixel units
with origin at the upper left of the image. If the source dataset was
georeferenced, you would get similarly georeferenced geometries like this:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">shapes</span> <span class="o">=</span> <span class="n">features</span><span class="o">.</span><span class="n">shapes</span><span class="p">(</span><span class="n">blue</span><span class="p">,</span> <span class="n">mask</span><span class="o">=</span><span class="n">mask</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">src</span><span class="o">.</span><span class="n">transform</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="burning-shapes-into-a-raster">
<h2>Burning shapes into a raster<a class="headerlink" href="#burning-shapes-into-a-raster" title="Permalink to this headline">¶</a></h2>
<p>To go the other direction, use <code class="docutils literal"><span class="pre">rasterize()</span></code> to burn values into the pixels
intersecting with geometries.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">image</span> <span class="o">=</span> <span class="n">features</span><span class="o">.</span><span class="n">rasterize</span><span class="p">(</span>
            <span class="p">((</span><span class="n">g</span><span class="p">,</span> <span class="mi">255</span><span class="p">)</span> <span class="k">for</span> <span class="n">g</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">shapes</span><span class="p">),</span>
            <span class="n">out_shape</span><span class="o">=</span><span class="n">src</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</pre></div>
</div>
<p>By default, only pixels whose center is within the polygon or that
are selected by Bresenham&#8217;s line algorithm will be burned in.
You can specify <code class="docutils literal"><span class="pre">all_touched=True</span></code> to burn in all pixels touched by the geometry.
The geometries will be rasterized by the &#8220;painter&#8217;s algorithm&#8221; -
geometries are handled in order and later geometries will overwrite earlier values.</p>
<p>Again, to burn in georeferenced shapes, pass an appropriate transform for the
image to be created.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">image</span> <span class="o">=</span> <span class="n">features</span><span class="o">.</span><span class="n">rasterize</span><span class="p">(</span>
            <span class="p">((</span><span class="n">g</span><span class="p">,</span> <span class="mi">255</span><span class="p">)</span> <span class="k">for</span> <span class="n">g</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">shapes</span><span class="p">),</span>
            <span class="n">out_shape</span><span class="o">=</span><span class="n">src</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span>
            <span class="n">transform</span><span class="o">=</span><span class="n">src</span><span class="o">.</span><span class="n">transform</span><span class="p">)</span>
</pre></div>
</div>
<p>The values for the input shapes are replaced with <code class="docutils literal"><span class="pre">255</span></code> in a generator
expression. Areas not covered by input geometries are replaced with an
optional <code class="docutils literal"><span class="pre">fill</span></code> value, which defaults to <code class="docutils literal"><span class="pre">0</span></code>. The resulting image,
written to disk like this,</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">rasterio</span><span class="o">.</span><span class="n">open</span><span class="p">(</span>
        <span class="s1">&#39;/tmp/rasterized-results.tif&#39;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">,</span>
        <span class="n">driver</span><span class="o">=</span><span class="s1">&#39;GTiff&#39;</span><span class="p">,</span>
        <span class="n">dtype</span><span class="o">=</span><span class="n">rasterio</span><span class="o">.</span><span class="n">uint8</span><span class="p">,</span>
        <span class="n">count</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">width</span><span class="o">=</span><span class="n">src</span><span class="o">.</span><span class="n">width</span><span class="p">,</span>
        <span class="n">height</span><span class="o">=</span><span class="n">src</span><span class="o">.</span><span class="n">height</span><span class="p">)</span> <span class="k">as</span> <span class="n">dst</span><span class="p">:</span>
    <span class="n">dst</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">indexes</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
<p>has a black background and white foreground features.</p>
<img alt="https://farm4.staticflickr.com/3728/13547425455_79bdb5eaeb_o_d.png" src="https://farm4.staticflickr.com/3728/13547425455_79bdb5eaeb_o_d.png" />
</div>
</div>


           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="fillnodata.html" class="btn btn-neutral float-right" title="Filling nodata areas" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="errors.html" class="btn btn-neutral" title="Error Handling" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2016, Mapbox.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'1.0a9',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>